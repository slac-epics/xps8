record(longout, "$(DEVICE)_4148:UpdateMultiplier") {
  field(DESC, "Update Multiplier")
  field(VAL,  "$(multiplier)")
}

record(calcout, "$(DEVICE)_4148:UpdateClock") {
  field(DESC, "Update Clock")
  field(INPA, "$(DEVICE)_4148:UpdateClock")
  field(INPB, "$(DEVICE)_4148:UpdateMultiplier NPP")
  field(OUT,  "$(DEVICE)_4148:UpdateToggle.PROC")
  field(CALC, "(A+1)%B")
  field(OCAL, "1")
  field(OOPT, "When Zero")
  field(DOPT, "Use OCAL")
  field(SCAN, "$(basePeriod)")
}

record(calc, "$(DEVICE)_4148:UpdateToggle") {
  field(DESC, "Update Toggle")
  field(INPA, "$(DEVICE)_4148:UpdateToggle")
  field(CALC, "1-A")
  field(FLNK, "$(DEVICE)_4148:UpdateEvtSeq")
  field(SCAN, "Passive")
}

record(calcout, "$(DEVICE)_4148:UpdateEvtSeq") {
  field(DESC, "Update Event Sequencer")
  field(INPA, "$(DEVICE)_4148:UpdateEvtSeq")
  field(INPB, "$(DEVICE)_4148:UpdateToggle")
  field(OUT,  "$(DEVICE)_4148:UpdateEvtGen.VAL PP")
  field(CALC, "A%16+1")
  field(OCAL, "MIN(FLOOR((A%16+2.1)/2)+B*9,9)")
  field(DOPT, "Use OCAL")
  field(OOPT, "Every Time")
  field(SCAN, "Passive")
}

record(event, "$(DEVICE)_4148:UpdateEvtGen") {
  field(DESC, "Update Event Generator")
  field(SCAN, "Passive")
}

